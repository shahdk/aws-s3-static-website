# aws-s3-static-website
Terraform module for hosting a secure static website on AWS S3

| WARNING: This is a highly opinionated terraform module for hosting secure static website on S3|
| --- |

To get a better understanding of how the module was created, please read through 
[my blog](https://terraform.training/s3/cloudfront/route53/acm/2020/08/07/s3-static-secure/index.html).

Especially, pay attention to how I am using different profiles for each resource to improve my security posture.
This module assumes that you follow the same posture for your use-case, and therefore, requires you to have created the
profiles as directed in the [blog](https://terraform.training/s3/cloudfront/route53/acm/2020/08/07/s3-static-secure/index.html).

Finally, lot of the options that you usually find for the given resource have been removed or hidden away from users.

## Module Documentation generated by `terraform-docs`

### Requirements

| Name | Version |
|------|---------|
| terraform | >= 0.13.0 |

### Providers

| Name | Version |
|------|---------|
| aws.tf-budget | n/a |
| aws.tf-certificatemanager | n/a |
| aws.tf-cloudfront | n/a |
| aws.tf-resource-group | n/a |
| aws.tf-route53 | n/a |
| aws.tf-s3 | n/a |

### Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| root\_domain\_name | The domain name for the static website. It will be used to create the S3 buckets and certificate for CloudFront | `string` | n/a | yes |
| budget\_account\_id | (Optional) The ID of the target account for budget. Will use current user's account\_id by default if omitted | `string` | `null` | no |
| budget\_cost\_filters | (Optional) Map of CostFilters key/value pairs to apply to the budget.<br>TF Docs: https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/budgets_budget#CostFilters<br>AWS Docs: https://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/billing-what-is.html | `map(string)` | `null` | no |
| budget\_cost\_types | (Optional) Object containing CostTypes The types of cost included in a budget, such as tax and subscriptions.<br>TF Docs: https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/budgets_budget#CostTypes<br>AWS Docs: https://docs.aws.amazon.com/aws-cost-management/latest/APIReference/API_budgets_CostTypes.html | <pre>object({<br>    include_credit             = bool<br>    include_discount           = bool<br>    include_other_subscription = bool<br>    include_recurring          = bool<br>    include_refund             = bool<br>    include_subscription       = bool<br>    include_support            = bool<br>    include_tax                = bool<br>    include_upfront            = bool<br>    use_amortized              = bool<br>    use_blended                = bool<br>  })</pre> | `null` | no |
| budget\_limit\_amount | (Required) The amount of cost or usage being measured for a budget. | `string` | `""` | no |
| budget\_limit\_unit | (Required) The unit of measurement used for the budget forecast, actual spend, or budget threshold,<br>such as dollars or GB. See [Spend](http://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/data-type-spend.html)<br>documentation. | `string` | `""` | no |
| budget\_name | (Optional) The name of a budget. Unique within accounts. | `string` | `null` | no |
| budget\_notifications | (Optional) List of Object containing Budget Notifications, ie, you can create multiple ways to notify<br>See: https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/budgets_budget#BudgetNotification | <pre>list(object({<br>    comparison_operator        = string<br>    threshold                  = number<br>    threshold_type             = string<br>    notification_type          = string<br>    subscriber_email_addresses = list(string)<br>    subscriber_sns_topic_arns  = list(string)<br>  }))</pre> | `[]` | no |
| budget\_time\_period\_end | (Optional) The end of the time period covered by the budget. There are no restrictions on the end date.<br>Format: `2017-01-01_12:00`. | `string` | `null` | no |
| budget\_time\_period\_start | (Required) The start of the time period covered by the budget. The start date must come before the end date.<br>Format: `2017-01-01_12:00`. | `string` | `""` | no |
| budget\_time\_unit | (Required) The length of time until a budget resets the actual and forecasted spend.<br>Valid values: MONTHLY, QUARTERLY, ANNUALLY. | `string` | `""` | no |
| budget\_type | (Required) Whether this budget tracks monetary cost or usage. | `string` | `"COST"` | no |
| cf\_cache\_allowed\_methods | (Required) - Controls which HTTP methods CloudFront processes and forwards to your Amazon S3 bucket or<br>your custom origin. | `list(string)` | <pre>[<br>  "GET",<br>  "HEAD"<br>]</pre> | no |
| cf\_cache\_cached\_methods | (Required) - Controls whether CloudFront caches the response to requests using the specified HTTP methods. | `list(string)` | <pre>[<br>  "GET",<br>  "HEAD"<br>]</pre> | no |
| cf\_cache\_compress | (Optional) - Whether you want CloudFront to automatically compress content for web requests that include<br>Accept-Encoding: gzip in the request header. | `bool` | `false` | no |
| cf\_cache\_field\_level\_encryption\_id | (Optional) - Field level encryption configuration ID | `string` | `null` | no |
| cf\_cache\_forwarded\_values | (Required) - The forwarded values configuration that specifies how CloudFront handles query strings,<br>cookies and headers.<br>TF Docs: https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_distribution#forwarded-values-arguments | <pre>object({<br>    cookies = object({<br>      forward           = string<br>      whitelisted_names = list(string)<br>    })<br>    headers                 = set(string)<br>    query_string            = bool<br>    query_string_cache_keys = bool<br>  })</pre> | <pre>{<br>  "cookies": {<br>    "forward": "none",<br>    "whitelisted_names": []<br>  },<br>  "headers": [],<br>  "query_string": false,<br>  "query_string_cache_keys": false<br>}</pre> | no |
| cf\_cache\_geo\_restriction | (Required) - The restriction configuration for this distribution (maximum one).<br>The `restrictions` sub-resource takes another single sub-resource named `geo_restriction`<br>The arguments of geo\_restriction are:<br>- locations (Optional) : The ISO 3166-1-alpha-2 codes for which you want CloudFront either to distribute your<br>    content (whitelist) or not distribute your content (blacklist).<br>- restriction\_type (Required) : The method that you want to use to restrict distribution of your content<br>  by country: none, whitelist, or blacklist. | <pre>object({<br>    locations        = set(string)<br>    restriction_type = string<br>  })</pre> | <pre>{<br>  "locations": [],<br>  "restriction_type": "none"<br>}</pre> | no |
| cf\_cache\_lambda\_function\_association | (Optional) - A config block that triggers a lambda function with specific actions. maximum 4.<br>TF Docs: https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_distribution#lambda_function_association | <pre>list(object({<br>    event_type   = string<br>    lambda_arn   = string<br>    include_body = bool<br>  }))</pre> | `[]` | no |
| cf\_cache\_smooth\_streaming | (Optional) - Indicates whether you want to distribute media files in Microsoft Smooth Streaming format<br>using the origin that is associated with this cache behavior. | `bool` | `null` | no |
| cf\_cache\_trusted\_signers | (Optional) - List of AWS account IDs (or self) that you want to allow to create signed URLs for private content.<br>See [CloudFront Docs](https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/private-content-trusted-signers.html)<br>for more information about this feature. | `list(string)` | `null` | no |
| cf\_cache\_viewer\_protocol\_policy | (Required) - Use this element to specify the protocol that users can use to access the files in the origin<br>specified by TargetOriginId.<br>One of allow-all, https-only, or redirect-to-https. | `string` | `"redirect-to-https"` | no |
| cf\_default\_cache\_ttl | (Optional) - The default amount of time (in seconds) that an object is in a CloudFront cache before<br>CloudFront forwards another request in the absence of an Cache-Control max-age or Expires header.<br>Defaults to 1 hour. | `number` | `3600` | no |
| cf\_max\_cache\_ttl | (Optional) - The maximum amount of time (in seconds) that an object is in a CloudFront cache before<br>CloudFront forwards another request to your origin to determine whether the object has been updated.<br>Only effective in the presence of Cache-Control max-age, Cache-Control s-maxage, and Expires headers.<br>Defaults to 1 day. | `number` | `86400` | no |
| cf\_min\_cache\_ttl | (Optional) - The minimum amount of time that you want objects to stay in CloudFront caches before<br>CloudFront queries your origin to see whether the object has been updated. Defaults to 0 seconds. | `number` | `0` | no |
| cf\_price\_class | (Optional) - The price class for this distribution. One of PriceClass\_All, PriceClass\_200, PriceClass\_100 | `string` | `"PriceClass_All"` | no |
| cf\_retain\_on\_delete | (Optional) - Disables the distribution instead of deleting it when destroying the resource through Terraform.<br>If this is set, the distribution needs to be deleted manually afterwards. Default: `false` | `bool` | `false` | no |
| cf\_viewer\_certificate\_min\_protocol | The minimum version of the SSL protocol that you want CloudFront to use for HTTPS connections.<br>Can only be set if cloudfront\_default\_certificate = false.<br>One of TLSv1, TLSv1\_2016, TLSv1.1\_2016, TLSv1.2\_2018 or TLSv1.2\_2019.<br>NOTE: If you are using a custom certificate (specified with acm\_certificate\_arn or iam\_certificate\_id), and<br>have specified sni-only in ssl\_support\_method, TLSv1 or later must be specified. | `string` | `"TLSv1.1_2016"` | no |
| cf\_wait\_for\_deployment | (Optional) - If enabled, the resource will wait for the distribution status to change from `InProgress`<br>to `Deployed`. Setting this to `false` will skip the process. Default: `true`. | `bool` | `true` | no |
| cf\_web\_acl\_id | (Optional) - If you're using AWS WAF to filter CloudFront requests, the Id of the AWS WAF web ACL that is<br>associated with the distribution. The WAF Web ACL must exist in the WAF Global (CloudFront) region and<br>the credentials configuring this argument must have `waf:GetWebACL` permissions assigned.<br>If using WAFv2, provide the ARN of the web ACL. | `string` | `null` | no |
| create\_budget\_notification | Flag to enable/disable creation of budget notification | `bool` | `true` | no |
| create\_resource\_group | Flag to enable/disable creation of the resource group | `bool` | `true` | no |
| s3\_website\_index\_doc | Amazon S3 returns this index document when requests are made to the root domain or any of the subfolders | `string` | `"index.html"` | no |

### Outputs

| Name | Description |
|------|-------------|
| acm\_certificate | AWS ACM Certificate object.<br>See https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/acm_certificate#attributes-reference<br>for more details |
| acm\_certificate\_validation | AWS ACM Certificate Validation object.<br>See https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/acm_certificate_validation#attributes-reference<br>for more details |
| budget | AWS Budgets object.<br>See https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/budgets_budget#attributes-reference<br>for more details |
| cloudfront\_distribution | AWS CloudFront distribution object.<br>See https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_distribution#attribute-reference<br>for more details |
| cloudfront\_origin\_access\_identity | AWS CloudFront origin access identity object.<br>See https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_origin_access_identity#attribute-reference<br>for more details |
| resource\_group | AWS Resource Group object.<br>See https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/resourcegroups_group#attributes-reference<br>for more details |
| route53\_cname\_record | AWS Route53 CNAME Record object for DNS validation.<br>See https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route53_record#attributes-reference<br>for more details |
| route53\_hosted\_zone | AWS Route53 Hosted Zone object.<br>See https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route53_zone#attributes-reference<br>for more details |
| route53\_root\_domain\_record | AWS Route53 A Record object for root domain.<br>See https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route53_record#attributes-reference<br>for more details |
| route53\_sub\_domain\_record | AWS Route53 A Record object for the www sub-domain.<br>See https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route53_record#attributes-reference<br>for more details |
| s3\_bucket\_policy\_root\_domain | AWS S3 bucket policy object for the root domain.<br>See https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_policy#argument-reference<br>for more details |
| s3\_bucket\_policy\_sub\_domain | AWS S3 bucket policy object for the www sub-domain.<br>See https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_policy#argument-reference<br>for more details |
| s3\_bucket\_root\_domain | AWS S3 bucket for the root domain.<br>See https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket#attributes-reference<br>for more details |
| s3\_bucket\_sub\_domain | AWS S3 bucket for the www sub-domain.<br>See https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket#attributes-reference<br>for more details |